# Безопасность наглядно: CORS

Во фронтенде часто требуется отобразить данные, которые хранятся в другом месте. 

Перед этим браузер должен направить запрос серверу: 

- клиент отправляет HTTP-запрос со всей информацией, которая нужна серверу, чтобы вернуть данные.

Представим, что нам надо получить информацию о пользователях для нашего сайта www.mywebsite.com с сервера, который находится по адресу api.website.com.

![help](https://miro.medium.com/max/552/1*YcZzHhIlw-QJlMey8dlENw.gif)

Сработало. Мы отправили HTTP-запрос на сервер, который вернул нужные нам данные в формате JSON. 

А теперь давайте попытаемся отправить точно такой же запрос, но с другого домена: вместо www.mywebsite.com возьмём www.anotherdomain.com.

![help](https://miro.medium.com/max/700/1*0NKA-k4-Na_C8xm4LGoubA.gif)

Что произошло? 

Мы отправили такой же запрос, но на этот раз браузер выдал странную ошибку. 

Мы только что увидели CORS в действии. 

Давайте разберёмся, почему возникла эта ошибка, и что она означает.

# Правило одинакового источника (Same-Origin Policy)

В веб внедрено так называемое правило одинакового источника.

По умолчанию мы можем получить доступ к ресурсам только в том случае, если источник этих ресурсов и источник запроса совпадают. 

К примеру, мы сможем без проблем загрузить изображение, которое находится по адресу https://mywebsite.com/image1.png.

**Ресурс считается принадлежащим к другому источнику (cross-origin), если он располагается на другом домене/поддомене, протоколе или порте.**

![help](https://miro.medium.com/max/700/1*9_c5qHZhImmawYinJBkDJg.png)

# Зачем оно надо?

Представим, что это правило не работает, а вы случайно нажали на какую-то вирусную ссылку

Ссылка перенаправляет вас на мошеннический сайт, который с помощью фрейма загружает интерфейс сайта вашего банка и успешно залогинивает вас с помощью сохранённых куки.

Разработчики этого мошеннического сайта сделали так, чтобы он имел доступ к фрейму и мог взаимодействовать с DOM сайта вашего банка — так они смогут переводить деньги на свой счёт от вашего имени.

![help](https://miro.medium.com/max/700/1*NWgtgPrtQneKv2Afh_XJNw.gif)

К счастью, здесь приходит на помощь правило одинакового источника: 

- оно гарантирует, что мы можем получить доступ только к ресурсам из того же самого источника.

![help](https://miro.medium.com/max/700/1*MNhe3ThgKySQs8I1XuSAQw.gif)

# CORS на стороне клиента

Несмотря на то, что правило одинакового источника применяется исключительно к скриптам, браузеры распространили его и на JavaScript-запросы: по умолчанию можно получить доступ к ресурсам только из одинакового источника.

![help](https://miro.medium.com/max/2400/1*GFSFIWzD6ndsdgYd1rwE-A.gif)

# Запросы

Чтобы обеспечить безопасность запросов к другим источникам, браузеры используют механизм под названием CORS.

Аббревиатура CORS расшифровывается как Cross-Origin Resource Sharing (Технология совместного использования ресурсов между разными источниками)

Несмотря на то, что браузеры не позволяют получать доступ к ресурсам из разных источников, можно использовать CORS, чтобы внести небольшие коррективы в эти ограничения

**Пользовательские агенты (к примеру, браузеры) на основе значений определённых заголовков для CORS в HTTP-запросе могут проводить запросы к другим источникам, которые без CORS были бы заблокированы.**

Чтобы разрешить запросы из других источников, можем добавить в HTTP-ответ дополнительные заголовки, начинающиеся с Access-Control-* (на стороне бэка)

Существует несколько CORS-заголовков, но браузеру нужен всего один из них, чтобы разрешить доступ к ресурсам из разных источников —Access-Control-Allow-Origin.


# Куки, document.cookie

Cookies - это технология, позволяющая сайтам сохранять в браузере небольшую порцию данных (до 4Кбайт).

Обычно эти данные используются на сайте для того, чтобы:

- "узнать" (идентифицировать) пользователя (эмулировать постоянное соединение с сервером);

- сохранить информацию о просмотренных страницах или товаров;

- осуществить простую защиту счётчиков и системы голосования от накрутки;

- запомнить настройки интерфейса, расположение блоков, товара, добавленного в корзину и много другого.

# Как работают cookies

![help](https://lh3.googleusercontent.com/proxy/DSJsL2O-VgOf6gsW8VRLL51gvq327VGjvqKXBKwBd4x9T5UNLTXBVC4uFQ9jnvVLEwWMjoaCLCSjZ8Vlab3AuMaz2ASCgPfvi8AvFqkQFz3zNuShMr5LIcFONLFwgG6OP8Ae_U6T_NLZFvIKWptfUSS7XJYp)






